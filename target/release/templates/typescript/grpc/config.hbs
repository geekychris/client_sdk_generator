/**
 * {{api_name}} TypeScript gRPC SDK Configuration
 * Generated by client-sdk-generator
 */

{{#if authentication}}
/**
 * Authentication configuration options
 */
export interface AuthConfig {
  {{#if supports_api_key}}
  /** API key for authentication */
  apiKey?: string;
  {{/if}}
  {{#if supports_bearer_auth}}
  /** Bearer token for authentication */
  bearerToken?: string;
  {{/if}}
  /** Custom authentication metadata */
  customMetadata?: Record<string, string>;
}
{{/if}}

{{#if features.retry}}
/**
 * Retry configuration options
 */
export interface RetryConfig {
  /** Maximum number of retry attempts */
  maxRetries: number;
  /** Base delay between retries in milliseconds */
  baseDelay: number;
  /** Maximum delay between retries in milliseconds */
  maxDelay: number;
  /** Exponential backoff multiplier */
  backoffMultiplier: number;
  /** gRPC status codes that should trigger a retry */
  retryableStatusCodes: number[];
}
{{/if}}

{{#if features.caching}}
/**
 * Caching configuration options
 */
export interface CacheConfig {
  /** Enable or disable caching */
  enabled: boolean;
  /** Time-to-live for cached responses in milliseconds */
  ttl: number;
  /** Maximum number of cached responses */
  maxSize: number;
}
{{/if}}

{{#if features.telemetry}}
/**
 * Telemetry configuration options
 */
export interface TelemetryConfig {
  /** Enable or disable telemetry */
  enabled: boolean;
  /** Endpoint for sending metrics */
  metricsEndpoint?: string;
  /** Service name for telemetry */
  serviceName: string;
}
{{/if}}

/**
 * gRPC-specific configuration options
 */
export interface GrpcConfig {
  /** Use TLS for the connection */
  useTLS: boolean;
  /** Server name for TLS verification */
  tlsServerName?: string;
  /** Maximum message size in bytes */
  maxMessageSize: number;
  /** Keep-alive interval in milliseconds */
  keepAliveInterval: number;
  /** Keep-alive timeout in milliseconds */
  keepAliveTimeout: number;
  /** Enable keep-alive pings */
  enableKeepAlive: boolean;
}

/**
 * Client configuration options for {{api_name}} gRPC API
 */
export interface ClientConfig {
  /** gRPC server address (e.g., "localhost:50051") */
  baseURL: string;
  
  /** Request timeout in milliseconds */
  timeout?: number;
  
  /** User agent string */
  userAgent?: string;
  
  {{#if authentication}}
  /** Authentication configuration */
  auth?: AuthConfig;
  {{/if}}
  
  {{#if features.retry}}
  /** Retry configuration */
  retry?: RetryConfig;
  {{/if}}
  
  {{#if features.caching}}
  /** Cache configuration */
  cache?: CacheConfig;
  {{/if}}
  
  {{#if features.telemetry}}
  /** Telemetry configuration */
  telemetry?: TelemetryConfig;
  {{/if}}
  
  /** gRPC-specific configuration */
  grpc?: GrpcConfig;
  
  /** Enable debug logging */
  debug?: boolean;
}

/**
 * Default configuration values
 */
export const DEFAULT_CONFIG: Partial<ClientConfig> = {
  timeout: 30000, // 30 seconds
  userAgent: '{{package}}-grpc-client/{{version}}',
  {{#if features.retry}}
  retry: {
    maxRetries: 3,
    baseDelay: 1000,
    maxDelay: 10000,
    backoffMultiplier: 2,
    retryableStatusCodes: [14, 8, 4], // UNAVAILABLE, RESOURCE_EXHAUSTED, DEADLINE_EXCEEDED
  },
  {{/if}}
  {{#if features.caching}}
  cache: {
    enabled: false,
    ttl: 300000, // 5 minutes
    maxSize: 1000,
  },
  {{/if}}
  {{#if features.telemetry}}
  telemetry: {
    enabled: true,
    serviceName: '{{package}}-grpc-client',
  },
  {{/if}}
  grpc: {
    useTLS: false,
    maxMessageSize: 4 * 1024 * 1024, // 4MB
    keepAliveInterval: 30000, // 30 seconds
    keepAliveTimeout: 5000, // 5 seconds
    enableKeepAlive: true,
  },
  debug: false,
};

/**
 * Merge user configuration with defaults
 */
export function createConfig(userConfig: ClientConfig): Required<ClientConfig> {
  return {
    ...DEFAULT_CONFIG,
    ...userConfig,
    {{#if authentication}}
    auth: userConfig.auth ? { ...userConfig.auth } : undefined,
    {{/if}}
    {{#if features.retry}}
    retry: userConfig.retry ? { ...DEFAULT_CONFIG.retry, ...userConfig.retry } : DEFAULT_CONFIG.retry!,
    {{/if}}
    {{#if features.caching}}
    cache: userConfig.cache ? { ...DEFAULT_CONFIG.cache, ...userConfig.cache } : DEFAULT_CONFIG.cache!,
    {{/if}}
    {{#if features.telemetry}}
    telemetry: userConfig.telemetry ? { ...DEFAULT_CONFIG.telemetry, ...userConfig.telemetry } : DEFAULT_CONFIG.telemetry!,
    {{/if}}
    grpc: userConfig.grpc ? { ...DEFAULT_CONFIG.grpc, ...userConfig.grpc } : DEFAULT_CONFIG.grpc!,
  } as Required<ClientConfig>;
}
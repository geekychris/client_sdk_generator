# {{api_name}} Go GraphQL SDK

{{#if description}}{{description}}{{/if}}

A Go GraphQL client library for the {{api_name}} API, generated by client-sdk-generator.

## Installation

```bash
go mod init your-project
go get {{go_module}}
```

## Usage

### Basic Usage

```go
package main

import (
    "context"
    "fmt"
    "log"
    "{{go_module}}"
)

func main() {
    config := {{package_name}}.ClientConfig{
        BaseURL: "{{graphql_endpoint}}",
        {{#if authentication}}
        Auth: &{{package_name}}.AuthConfig{
            {{#if supports_bearer_auth}}
            BearerToken: "your-token-here",
            {{/if}}
            {{#if supports_api_key}}
            APIKey: "your-api-key-here",
            {{/if}}
        },
        {{/if}}
    }
    
    client := {{package_name}}.New{{class_name}}(config)
    ctx := context.Background()
    
    // Execute a GraphQL query
    query := `
        query {
            users {
                id
                name
                email
            }
        }
    `
    
    var result map[string]interface{}
    err := client.Query(ctx, query, nil, &result)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf("Result: %+v\n", result)
}
```

### Query with Variables

```go
query := `
    query GetUser($id: ID!) {
        user(id: $id) {
            id
            name
            email
            profile {
                avatar
                bio
            }
        }
    }
`

variables := map[string]interface{}{
    "id": "123",
}

var result struct {
    User struct {
        ID      string `json:"id"`
        Name    string `json:"name"`
        Email   string `json:"email"`
        Profile struct {
            Avatar string `json:"avatar"`
            Bio    string `json:"bio"`
        } `json:"profile"`
    } `json:"user"`
}

err := client.Query(ctx, query, variables, &result)
if err != nil {
    log.Fatal(err)
}
```

### Mutations

```go
mutation := `
    mutation CreateUser($input: CreateUserInput!) {
        createUser(input: $input) {
            id
            name
            email
        }
    }
`

variables := map[string]interface{}{
    "input": map[string]interface{}{
        "name":  "John Doe",
        "email": "john@example.com",
    },
}

var result struct {
    CreateUser struct {
        ID    string `json:"id"`
        Name  string `json:"name"`
        Email string `json:"email"`
    } `json:"createUser"`
}

err := client.Mutate(ctx, mutation, variables, &result)
if err != nil {
    log.Fatal(err)
}
```

### Subscriptions

```go
subscription := `
    subscription {
        userUpdates {
            id
            name
            status
        }
    }
`

// Create subscription
sub, err := client.Subscribe(ctx, subscription, nil)
if err != nil {
    log.Fatal(err)
}
defer sub.Close()

// Listen for updates
for {
    var update struct {
        UserUpdates struct {
            ID     string `json:"id"`
            Name   string `json:"name"`
            Status string `json:"status"`
        } `json:"userUpdates"`
    }
    
    err := sub.Next(&update)
    if err != nil {
        if err == io.EOF {
            break
        }
        log.Printf("Subscription error: %v", err)
        continue
    }
    
    fmt.Printf("User update: %+v\n", update.UserUpdates)
}
```

{{#if authentication}}
### Authentication

This SDK supports the following authentication methods:

{{#if supports_bearer_auth}}
#### Bearer Token (JWT)

```go
config := {{package_name}}.ClientConfig{
    BaseURL: "{{graphql_endpoint}}",
    Auth: &{{package_name}}.AuthConfig{
        BearerToken: "your-jwt-token",
    },
}
```
{{/if}}

{{#if supports_api_key}}
#### API Key

```go
config := {{package_name}}.ClientConfig{
    BaseURL: "{{graphql_endpoint}}",
    Auth: &{{package_name}}.AuthConfig{
        APIKey: "your-api-key",
    },
}
```
{{/if}}

You can also update authentication credentials after creating the client:

```go
client := {{package_name}}.New{{class_name}}(config)
{{#if supports_bearer_auth}}
client.SetBearerToken("new-token")
{{/if}}
{{#if supports_api_key}}
client.SetAPIKey("new-api-key")
{{/if}}
```
{{/if}}

## Advanced Features

### Custom HTTP Headers

```go
config := {{package_name}}.ClientConfig{
    BaseURL: "{{graphql_endpoint}}",
    Headers: map[string]string{
        "Custom-Header": "value",
        "User-Agent":    "my-app/1.0",
    },
}
```

### Request Timeout

```go
import "time"

ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
defer cancel()

err := client.Query(ctx, query, variables, &result)
```

### Retry Configuration

```go
config := {{package_name}}.ClientConfig{
    BaseURL:    "{{graphql_endpoint}}",
    MaxRetries: 3,
    RetryDelay: time.Second * 2,
}
```

### Custom HTTP Client

```go
import (
    "net/http"
    "time"
)

httpClient := &http.Client{
    Timeout: 60 * time.Second,
    Transport: &http.Transport{
        MaxIdleConns:        100,
        MaxIdleConnsPerHost: 100,
    },
}

config := {{package_name}}.ClientConfig{
    BaseURL:    "{{graphql_endpoint}}",
    HTTPClient: httpClient,
}
```

## Query Builder

Use the built-in query builder for type-safe query construction:

```go
import "{{go_module}}/builder"

// Build a query
query := builder.NewQuery().
    Field("users").
        Field("id").
        Field("name").
        Field("email").
    End().
    Build()

// Build a query with variables
query := builder.NewQuery().
    WithVariable("id", "ID!").
    Field("user").
        WithArgs(map[string]interface{}{"id": "$id"}).
        Field("id").
        Field("name").
        Field("profile").
            Field("avatar").
            Field("bio").
        End().
    End().
    Build()
```

### Fragments

```go
userFragment := builder.NewFragment("UserFragment", "User").
    Field("id").
    Field("name").
    Field("email").
    Build()

query := builder.NewQuery().
    Field("users").
        Fragment(userFragment).
    End().
    Build()
```

## Schema Types

{{#each types}}
### `{{go_name name}}`

{{#if description}}{{description}}{{/if}}

```go
type {{go_name name}} struct {
    {{#each properties}}
    {{go_name name}} {{go_type data_type}} `json:"{{json_name}}"` {{#if description}}// {{description}}{{/if}}
    {{/each}}
}
```

{{/each}}

## Error Handling

The SDK provides structured error handling for GraphQL errors:

```go
import "{{go_module}}/errors"

err := client.Query(ctx, query, variables, &result)
if err != nil {
    if gqlErr, ok := err.(*errors.GraphQLError); ok {
        fmt.Printf("GraphQL errors: %+v\n", gqlErr.Errors)
        for _, e := range gqlErr.Errors {
            fmt.Printf("Error: %s at %v\n", e.Message, e.Locations)
            if len(e.Path) > 0 {
                fmt.Printf("Path: %v\n", e.Path)
            }
        }
    } else {
        // Handle HTTP or other errors
        log.Printf("Request error: %v", err)
    }
}
```

## Introspection

Query the GraphQL schema:

```go
schema, err := client.IntrospectSchema(ctx)
if err != nil {
    log.Fatal(err)
}

fmt.Printf("Schema types: %v\n", len(schema.Types))
```

## File Uploads (if supported)

```go
import (
    "os"
    "{{go_module}}/upload"
)

file, err := os.Open("document.pdf")
if err != nil {
    log.Fatal(err)
}
defer file.Close()

mutation := `
    mutation UploadFile($file: Upload!) {
        uploadFile(file: $file) {
            id
            filename
            url
        }
    }
`

variables := map[string]interface{}{
    "file": upload.NewFile(file, "document.pdf", "application/pdf"),
}

var result struct {
    UploadFile struct {
        ID       string `json:"id"`
        Filename string `json:"filename"`
        URL      string `json:"url"`
    } `json:"uploadFile"`
}

err = client.Mutate(ctx, mutation, variables, &result)
if err != nil {
    log.Fatal(err)
}
```

## Performance Tips

1. **Use specific field selections**: Only request the fields you need
2. **Batch queries**: Combine multiple queries using GraphQL aliases
3. **Connection pooling**: Reuse HTTP connections with custom HTTP client
4. **Caching**: Implement client-side caching for frequently accessed data

```go
// Example: Batched query with aliases
query := `
    query {
        currentUser: user(id: "current") {
            id
            name
        }
        adminUser: user(id: "admin") {
            id
            name
        }
    }
`
```

## License

This SDK is generated by client-sdk-generator and is available under the MIT License.